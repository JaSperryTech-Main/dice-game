import{r as p,j as s,y as h}from"./vendor-react.B5Kz-_CL.js";import{u as P,a as O,b as B,c as S}from"./index.CwCnsldo.js";import{R as U}from"./vendor.B5jnI0H-.js";const H=new U,M=()=>{const{player:l,addGold:b}=P(),{dice:f}=O(),[g,v]=p.useState(!1),m=p.useRef([]);p.useEffect(()=>{m.current=l.dices.map((i,d)=>m.current[d]||null)},[l.dices]);const $=async()=>{if(g)return;v(!0);const i=[...l.dices],d=l.upgrades.rollSpeed||0,o=i.map(x=>{const e=f[x]||{sides:1,multiplier:1};let t=1;try{t=H.roll(`1d${e.sides}`).result}catch(r){console.error(`Error rolling dice ${x}:`,r)}return{diceType:x,result:t,finalResult:t*e.multiplier,sides:e.sides}}),a=o.reduce((x,{finalResult:e})=>x+e,0),C=i.map((x,e)=>new Promise(t=>{var N;const r=(N=m.current[e])==null?void 0:N.querySelector(".dice-text");if(!r){t();return}let n=!1;const u=o[e].sides;r.classList.add("rolling");const c=setInterval(()=>{n||(r.textContent=Math.floor(Math.random()*u)+1)},50),w=Math.random()*3+2,D=Math.min(.5*d*1e3,w*1e3-500),R=Math.max(500,w*1e3-D);setTimeout(()=>{n=!0,clearInterval(c),r.classList.remove("rolling"),r.textContent=o[e].result,t()},R)}));await Promise.all(C),b(a),h.success(`🎲 You earned ${a} gold!`,{position:"top-right",autoClose:1e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"}),v(!1)},y={common:"border-gray-400 text-gray-600",uncommon:"border-green-500 text-green-500",rare:"border-blue-500 text-blue-500",epic:"border-purple-500 text-purple-500",legendary:"border-yellow-500 text-yellow-500"},j=[...l.dices].sort((i,d)=>{const o=f[i]||{multiplier:1,sides:6},a=f[d]||{multiplier:1,sides:6};return a.multiplier!==o.multiplier?a.multiplier-o.multiplier:a.sides-o.sides});return s.jsxs("div",{className:"flex content-center items-center h-screen w-[66vw] flex-col relative",children:[s.jsx("div",{className:"grid grid-cols-5 gap-x-[5vh] gap-y-[5vw] w-[85%] min-h-[66vh] justify-items-center mt-[5vh] mb-[15vh] overflow-y-auto p-2.5",children:j.map((i,d)=>{const o=f[i]||{multiplier:1,sides:6};return s.jsxs("div",{ref:a=>m.current[d]=a,role:"button","aria-label":`Dice: d${o.sides} x${o.multiplier}`,className:`dice w-[120px] h-[120px] bg-white border-2 ${y[o.id||"common"]} flex justify-center items-center text-[50px] font-bold rounded-[15px] shadow-[0_4px_8px_rgba(0,0,0,0.2)] transition-transform duration-200 ease-in-out transform hover:scale-105 cursor-pointer relative ${g?"pointer-events-none opacity-70":""}`,children:[s.jsx("p",{className:"dice-text",children:"1"}),s.jsxs("div",{className:"absolute bottom-2 right-2 text-[16px] font-semibold text-gray-600",children:["x",o.multiplier]}),s.jsxs("div",{className:"absolute top-2 left-2 text-[14px] font-semibold text-gray-600",children:["d",o.sides]})]},`dice-${i}-${d}`)})}),s.jsx("button",{onClick:$,disabled:g,"aria-label":"Roll Dice",className:`absolute bottom-5 left-1/2 transform -translate-x-1/2 px-8 py-4 text-lg cursor-pointer border-none rounded-full transition-all duration-300 ease-in-out ${g?"bg-gray-400 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"}`,children:g?"Rolling...":"Roll Dice"})]})},E=()=>{const{player:l,removeGold:b,addDice:f,getUpgrades:g,addUpgrade:v}=P(),{upgrades:m}=B(),{Packs:$}=S(),[y,j]=p.useState("upgrades"),[i,d]=p.useState(null),[o,a]=p.useState({}),C=(e,t=1)=>{const r=m.find(c=>c.id===e);if(!r){console.error(`Upgrade ${e} not found.`);return}if(r.max<=o[e]){h.warn(`❌ ${r.title} is already at maximum level!`,{position:"top-right",autoClose:1e3,pauseOnHover:!1,hideProgressBar:!0});return}const n=o[e]||0,u=r.cost*(n+1);l.gold>=u?(b(u),v(e,t),a(c=>({...c,[e]:n+1})),a(g()),h.success(`🆙 ${r.title} upgraded to level ${n+1}!`,{position:"top-right",autoClose:1e3,pauseOnHover:!1,hideProgressBar:!0})):h.error(`💰 You need ${u-l.gold} more gold for ${r.title}`,{position:"top-right",autoClose:1e3,pauseOnHover:!1,hideProgressBar:!0})},x=(e,t)=>{if(l.gold>=t.cost){b(t.cost);const r=t.chooseItem();f(r),d(e),h.success(`🎁 Opened ${e} and got a new ${r} die!`,{position:"top-right",autoClose:1e3,pauseOnHover:!1,hideProgressBar:!0}),setTimeout(()=>d(null),250)}else h.error(`💰 You need ${t.cost-l.gold} more gold to open ${e}`,{position:"top-right",autoClose:1e3,pauseOnHover:!1,hideProgressBar:!0})};return p.useEffect(()=>{a(g())},[l.upgrades]),s.jsxs("aside",{className:"w-[33vw] h-screen p-5 box-border bg-[#f8f8f8] flex flex-col text-center",children:[s.jsxs("div",{className:"w-full flex justify-between items-center mb-5",children:[s.jsxs("p",{className:"text-lg font-semibold",children:["Gold: ",l.gold.toFixed(0)]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>j("upgrades"),className:"px-3 py-1 bg-gray-300 rounded hover:bg-gray-400",children:"Upgrades"}),s.jsx("button",{onClick:()=>j("packs"),className:"px-3 py-1 bg-gray-300 rounded hover:bg-gray-400",children:"Packs"})]})]}),y==="upgrades"&&s.jsx("div",{className:"flex flex-col overflow-y-auto max-h-full pr-2",children:s.jsx("div",{className:"space-y-5 mr-5",children:m.map(e=>{const t=o[e.id]||0,r=e.cost*(t+1),n=t>=e.max,u=l.gold>=r,c=n||!u,w=n?"Max":t>0?"Upgrade":"Buy";return s.jsxs("div",{className:"grid grid-cols-2 grid-rows-2 gap-3 p-5 border rounded-xl bg-white shadow-lg hover:shadow-xl transition-shadow duration-300",children:[s.jsxs("h2",{className:"col-start-1 row-start-1 self-start justify-self-start text-xl font-semibold text-gray-800",children:[e.title,s.jsx("p",{children:t>0&&`(Lv. ${t} / Lv. ${e.max})`})]}),s.jsxs("h4",{className:"col-start-2 row-start-1 self-start justify-self-end text-md text-gray-700",children:["Cost: ",r]}),s.jsx("p",{className:"col-start-1 row-start-2 self-end justify-self-start text-sm text-gray-500",children:e.description}),s.jsx("button",{onClick:()=>C(e.id),className:`
    col-start-2 row-start-2 self-end justify-self-end 
    px-4 py-2 rounded-lg shadow-md transition-all duration-200
    ${c?"bg-blue-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 cursor-pointer"}
    text-white
  `,disabled:c,children:w})]},e.id)})})}),y==="packs"&&s.jsx("div",{className:"h-full overflow-y-auto flex flex-col gap-4 p-2 rounded",children:Object.entries($).map(([e,t])=>{const n=!(l.gold>=t.cost)||i===e,u=n?"bg-green-300 cursor-not-allowed":"bg-green-500 hover:bg-green-600 cursor-pointer",c=i===e?"Opened!":`Open ${e}`;return s.jsxs("div",{className:"grid grid-cols-1 gap-2 p-4 border rounded bg-white shadow",children:[s.jsx("h2",{className:"text-xl font-bold",children:e}),s.jsxs("p",{className:"text-gray-700",children:["Cost: ",t.cost," coins"]}),s.jsx("button",{className:`${u} text-black px-4 py-2 rounded`,onClick:()=>x(e,t),disabled:n,children:c})]},e)})})]})},L=()=>s.jsxs("main",{className:"bg-[#e0f7fa] m-0 flex content-center items-center min-h-screen h-full",children:[s.jsx(E,{}),s.jsx(M,{})]});export{L as default};
//# sourceMappingURL=Home.BNKROgUK.js.map
